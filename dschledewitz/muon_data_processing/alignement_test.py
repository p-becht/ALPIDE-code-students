#! /usr/bin/python

from itertools import takewhile
import re
import numpy as np
import matplotlib.pyplot as plt
import sys
from pprint import pprint

x_val = [[691.2, 435.10464572999996, 408.38135854260867, 469.72031340666666, 715.63369581, 486.88330008631584, 324.6469764733333], [863.0, 404.0379790633333, 807.75092376, 353.55364674, 376.73369581, 437.65147051238097, 831.31364314], [549.7333333333333, 229.10464573000002, 322.38135854260867, 501.1925356288889, 362.48369581, 718.3657562266666, 701.06364314], [214.0, 109.32964573, 563.75092376, 590.9465038828571, [], 349.5657562266667, 440.81364314], [61.666666666666664, 268.67607430142857, 277.0842570933333, 460.6131705495238, 472.73369581, 387.19908956, 287.08637041272726], [587.8378378378378, 592.3046457300001, 609.8725453816216, 548.3918820341177, 468.4765529528571, 324.95908956, 459.78661611297304], [336.0833333333333, 775.3969534223078, 554.85092376, 464.05364674, 710.2892513655555, 546.3809077418181, []], [161.5, 582.8713123966667, [], 823.6607895971429, 797.6622672385714, 604.69908956, 722.31364314], [733.0, 642.0682820936364, 381.03663804571426, 587.4465038828571, 342.9781402544445, 674.5324228933333, 253.14697647333332], [53.0, 299.70464573, 314.25092376, 328.80364674, 346.23369581, 357.19908956, 225.61364314000002], [412.0, 266.20464573, 696.25092376, 510.0344159707692, 459.44798152428575, 605.9848038457143, 236.31364314], [523.0714285714286, 561.70464573, 753.630670595443, 607.2703134066667, 234.69523427153845, 375.16062802153846, 526.4803098066666], [389.0, 562.20464573, 270.00092376, 185.30364674, 645.4705379152631, 640.69908956, 297.17078599714284], [680.8620689655172, 470.1591911845454, 411.15092375999996, 566.17864674, 617.4155139918181, 403.7824228933333, 414.0993574257143], [[], 553.0204352036842, 427.1398126488889, 534.2703134066667, 458.98369581, 801.3913972523077, 669.81364314], [529.8378378378378, 714.95464573, 826.8898126488889, 630.6369800733333, 484.55869581, 601.6121330382608, 480.35210467846156], [627.8, 1005.20464573, 426.52365103272723, [], 567.5336958099999, 162.92131178222223, 710.6597969861538], [[], 607.95464573, 366.25092376, 510.80364674, [], 284.51158956, 606.41364314], [926.2, 930.95464573, [], 903.80364674, 510.81061888692307, 498.69908956, 116.31364314], [658.5, 687.70464573, 463.53663804571426, 328.30364674, 529.4578337410345, 391.0800419409524, 481.56364314], [708.3333333333334, 560.70464573, 637.2124622215384, 510.30364674, 618.7670291433333, 450.3657562266667, []], [179.2, 529.70464573, [], [], 739.73369581, [], 557.31364314], [410.875, 627.3713123966667, 473.53663804571426, 656.80364674, 896.0670291433333, 536.2546451155555, 437.90455223090913], [221.6153846153846, 301.34750287285715, 632.1982921810526, 478.54048884526316, 217.27215734846155, 389.69908956, 277.31364314], [979.8571428571429, 625.98464573, 444.50092376, 511.5369800733333, 453.93369581, 682.4768673377778, 513.3850717114285], [559.7777777777778, 414.1332171585714, 854.87592376, 877.6607895971429, 712.70869581, 537.2705181314285, 265.42902775538465], [705.0, 835.20464573, 741.5842570933333, 382.1369800733333, 746.5908386671429, 643.69908956, 205.21364314], [82.91666666666667, 822.8475028728571, 302.82235233142853, 661.36614674, 561.23369581, 499.19908956, 489.1469764733334], [399.0, 736.2760743014286, 781.45092376, 605.3750753114285, 766.4003624766666, 467.0324228933333, 471.1469764733334], [339.2, 509.70464573, 480.25092376, 399.3869800733333, 210.73369581, 793.29908956, 805.6469764733333], [499.36, 683.32964573, 550.5275195046809, 497.0917823332203, 466.1474889134482, 567.7587910525373, 353.81364314], [[], 652.95464573, 309.85092376, 438.58142451777775, 419.06702914333334, 404.88658956, 111.81364314], [286.0, [], 843.25092376, 686.00364674, 355.23369581, [], 209.81364314], [524.3333333333334, 188.20464573, 365.85092376, 178.80364674, 357.0064230827272, 576.4848038457143, 399.9565002828572], [600.2857142857143, 567.2928810241177, 509.47949518857143, 749.67864674, 528.73369581, 388.07408956, 458.6469764733334], [551.1363636363636, 659.2602012855556, 370.81849132756753, 424.15499809135133, 351.20539392320757, 370.1108542658824, 625.4500067763636]]
y_val = [[330.36, 283.54300534, 273.87016298913045, 109.61133914333332, 385.67937337999996, 244.4743190694737, 187.56042459], [231.71428571428572, 344.84300534, 408.78864125, 268.77800581, 516.77937338, 292.82895566095243, 417.66042459], [334.73333333333335, 75.94300533999998, 402.4353803804348, 366.58356136555557, 181.77937338, 297.6146699466667, 83.74375792333333], [222.5, 239.84300534, 319.91364125, 400.88514866714286, [], 132.91466994666666, 265.66042459], [351.1666666666667, 185.38586248285714, 329.2469745833333, 232.07562485761903, 278.17223052285715, 287.62657470857147, 178.84224277181818], [284.81081081081084, 270.44300534, 288.85958719594595, 251.08682933941176, 248.72223052285716, 281.72800328, 322.0658299954054], [199.25, 169.99685149384615, 228.91364125, 398.40300581, 374.44604004666667, 307.35709418909096, []], [448.5, 325.84300534, [], 243.31372009571427, 127.35080195142856, 154.44800328, -15.339575409999998], [264.2, 286.2520962490909, 268.48506982142857, 212.99229152428572, 119.40159560222222, 253.11466994666668, 211.99375792333333], [391.0, 113.84300533999999, 151.91364125, 196.02800581, 232.77937338, 274.44800328, 209.26042458999999], [21.0, 396.84300534, 268.41364125, 212.79723657923077, 209.77937338, 151.44800328, 122.16042459], [275.42857142857144, 27.50967200666667, 201.5465526424051, 237.82800581, 322.27937338, 196.60184943384616, 152.82709125666665], [106.8, 236.84300534, 208.91364125, 468.02800581, 82.67411022210526, 182.94800328, 157.01756744714285], [313.37931034482756, 206.93391443090908, 344.21364125, 182.94467247666665, 123.46119156181818, 135.86466994666665, 198.3389960185714], [[], 286.52721586631577, 161.58030791666667, 217.62800581, 293.1365162371428, 175.98646481846154, 267.16042459], [247.16216216216216, 169.45014819714285, 269.10808569444447, 161.61133914333334, 319.45437338, 181.8393076278261, 208.4552963848718], [223.2, 156.04300533999998, 322.0954594318182, [], 367.97937337999997, 213.67022550222222, 329.42965535923076], [[], 255.34300534, 124.24697458333333, 153.52800581, [], 195.69800328, 309.86042459], [212.2, 193.25967200666665, [], 432.52800581, 276.7024503030769, 287.94800328, 381.8270912566667], [224.75, 107.66653475176469, 283.34221267857146, 202.29723657923077, 266.3655802765517, 289.44800328, 335.7020912566667], [271.5, 302.34300534, 336.7597950961539, 135.52800581, 318.67937337999996, 289.1146699466667, []], [90.6, 272.84300534, [], [], 196.61270671333335, [], 401.16042459], [292.125, 151.00967200666665, 391.84221267857146, 196.52800581, 403.0015956022222, 246.67022550222222, 122.66042459], [272.46153846153845, 93.05729105428571, 461.8083780921053, 260.60695317842107, 222.85629645692308, 294.19800328, 237.66042459], [356.57142857142856, 264.44300534, 345.4969745833333, 399.2946724766667, 334.97937337999997, 190.5591143911111, 174.0889960185714], [236.44444444444446, 223.41443391142855, 353.91364125, 238.07562485761903, 260.57937338, 260.87657470857147, 186.81427074384615], [429.0, 92.84300533999999, 228.58030791666667, 119.52800581, 76.4936590942857, 239.67022550222222, 312.86042459], [381.1666666666667, 365.7001481971428, 357.62792696428573, 270.34050581, 250.27937338, 281.03133661333334, 311.16042459], [184.0, 169.5572910542857, 208.31364125000002, 196.02800581, 414.22381782444444, -22.885330053333334, 173.4699483995238], [114.6, 301.1763386733333, 367.41364125, 147.44467247666665, 299.1127067133333, 191.24800328, 433.9937579233333], [275.36, 155.96800534, 259.74342848404257, 277.50258208118646, 295.19316648344824, 142.20919730985074, 197.36774166317073], [[], 279.59300534, 237.51364125, 382.36133914333334, 242.27937338, 220.63550328, 270.16042459], [204.0, [], 175.41364125, 248.42800581, 155.27937338, [], 143.16042459], [68.0, 166.84300534, 329.18030791666666, 397.77800581, 310.32482792545454, 148.8765747085714, 236.3747103042857], [312.7857142857143, 231.0194759282353, 424.0850698214286, 350.48633914333334, 259.20042601157894, 247.32300328, 161.72709125666665], [329.07954545454544, 199.3615238585185, 240.5893169256757, 238.59557337756758, 193.21333564415096, 202.85976798588234, 276.05436398393937]]
# calculate mean


def Mean(val, d_val):
    if val.size == 1:
        return int(val), 0  # ,0
    else:
        mean = np.mean(val)
        stat = np.sqrt(1/(val.size*(val.size-1)) *
                    np.sum((mean-val)**2))  # statistischer Fehler
        # sys = np.mean(d_val) #systematischer Fehler
        # print("Meanvalue:" , mean, " +- ", stat, "stat. +- ", sys, "sys")
        return mean, stat  # , sys


fig, (ax1,ax2) = plt.subplots(1,2,figsize=(14, 10))
ax1.set_xlim([0, 1024])
ax1.set_ylim([0, 512])
ax2.set_xlim([0, 1024])
ax2.set_ylim([0, 512])
for e in range(len(x_val)):
        all_c_x = np.array([])
        all_c_y = np.array([])
        missing = []
        for i in range(0, 7):
            # print(i)
            x_coor = np.array([])
            y_coor = np.array([])
            for line in planeData(event, i):
                # print(selectXandY(line))
                for pair in selectXandY(line):
                    x_coor = np.append(x_coor, int(pair[0]))
                    y_coor = np.append(y_coor, int(pair[1]))
            if x_coor.size != 0:
                mean_x, d_mean_x = Mean(x_coor, 0)
                mean_y, d_mean_y = Mean(y_coor, 0)
                mean_x = mean_x
                mean_y = mean_y
                all_x = np.append(all_x, mean_x)
                all_y = np.append(all_y, mean_y)
                all_c_x = np.append(all_c_x, mean_x-x[i])
                all_c_y = np.append(all_c_y, mean_y-y[i])
            else:
                missing.append(i)
        ax2.plot(all_x, all_y,"o-", label="Event "+ str(event_number)+", missing plane(s): "+str(missing))
        ax1.plot((all_c_x),(all_c_y),"o-", label="Event "+ str(event_number)+", missing plane(s): "+str(missing))
        ax2.plot(all_x[0], all_y[0],"ro-")
        ax1.plot((all_c_x[0]),(all_c_y[0]),"ro-")
        
        All_x.append(all_c_x)
        All_y.append(all_c_y)
ax1.legend()
plt.legend()
plt.show()

